name: Manual upload combo CSV to Pages

on:
  workflow_dispatch:
    inputs:
      combo_url:
        description: 'Direct URL to collectors_profiles_combo.csv (e.g., Arweave)'
        required: true

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages-manual-upload"
  cancel-in-progress: false

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare public dir
        run: |
          set -e
          mkdir -p public
          echo "Manual upload at $(date -u)" > public/index.html

      - name: Download combo CSV
        run: |
          set -e
          echo "Fetching ${{ inputs.combo_url }}"
          curl -fsSL --retry 3 --retry-delay 5 --max-time 180 "${{ inputs.combo_url }}" -o "public/collectors_profiles_combo.csv"
          test -s public/collectors_profiles_combo.csv
          ls -lh public/collectors_profiles_combo.csv

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4


